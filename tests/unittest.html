<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <script src="../javascripts/libs.js"></script>
  <script src="../javascripts/utils.js"></script>
  <script src="../javascripts/scanning.js"></script>
  <script src="fixtures/privacy-pages.js"></script>
  <script src="fixtures/privacy-settings-home.js"></script>
  <link rel="stylesheet" href="testsuite.css" type="text/css" media="screen" />

  <script>
  $(document).ready(function(){

module("Find dropdowns");

test("Detect open settings", function() {
  ok(scanningController, "The Scanning Controller should be available");
  stop();

  scanningController.getSettingInformation("div.uiSelector", basicDirectoryInfo1, function(value, total){
    equals(value, 3, "Should find at least one 'open' privacy setting");
    equals(total, 7, "The total number of settings should be correct");
    start();
  },
  [ {'name':              'default',
     'type':              'dropdown',
     'id':                '*',
     'recommended_level': DROPDOWN_VALUE_FRIENDS_OF_FRIENDS, } ]);
});

test("Detect all closed settings", function() {
  ok(scanningController, "The Scanning Controller should be available");
  stop();

  scanningController.getSettingInformation("div.uiSelector", basicDirectoryInfo2, function(value, total){
    equals(value, 0, "Should find no 'open' privacy settings");
    equals(total, 7, "The total number of settings should be correct");
    start();
  },
  [ {'name':              'default',
     'type':              'dropdown',
     'id':                '*',
     'recommended_level': DROPDOWN_VALUE_FRIENDS_OF_FRIENDS, } ]);
});

module("Find URLs in the privacy settings page");

test("Find URLs - basic", function() {
  stop();

  getUrlForV2Section('basic', function(url) {
      ok(url, "The 'basic' URL shouldn't be empty; was " + url);
      ok(/h=12345678901234567890123456789012/.test(url),
         "The hash in the URL should be correct");
      start();
    }, {'test': privacySettingsHTML1});
});

test("Find URLs - custom", function() {
  stop();

  getUrlForV2Section('custom', function(url) {
      ok(url, "The 'custom' URL shouldn't be empty; was " + url);
      ok(/h=12345678901234567890123456789012/.test(url),
         "The hash in the URL should be correct");
      start();
    }, {'test': privacySettingsHTML1});
});

module("Photo album privacy settings");

test("getPhotoAlbumSettings", function() {
  stop();

  scanningController.getPhotoAlbumSettings(function(openAlbums, totalAlbums){
      equals(openAlbums, 1,  "There is only one open album");
      equals(totalAlbums, 1, "There is only one album");
      start();
    }, photoAlbumPrivacy1);
});

module("Generic privacy settings");

test("getPrivacySettings - everything closed", function() {
  stop();

  scanningController.getPrivacySettings(function(openSettings, totalSettings){
      equals(openSettings, 0,  "Website shouldn't ever be considered open");
      equals(totalSettings, 18, "There should be 18 total settings");
      start();
    }, privacySettings2);
});

test("getPrivacySettings - one open", function() {
  stop();

  scanningController.getPrivacySettings(function(openSettings, totalSettings){
      equals(openSettings, 1,  "Post visibility should be detected as open");
      equals(totalSettings, 18, "There should be 18 total settings");
      start();
    }, privacySettings1);
});

test("getPrivacySettings - open checkbox", function() {
  stop();

  scanningController.getPrivacySettings(function(openSettings, totalSettings){
      equals(openSettings, 1,
             "The 'Include me in...' checkbox should be detected as open");
      equals(totalSettings, 21, "There should be 21 total settings");
      start();
    }, privacySettings3);
});

test("getPrivacySettings - checkbox without recommendation (off)", function() {
  stop();

  scanningController.getPrivacySettings(function(openSettings, totalSettings){
      equals(openSettings, 0,
             "The 'can friends post to wall?' should be ok off");
      equals(totalSettings, 21, "There should be 21 total settings");
      start();
    }, privacySettings4);
});

test("getPrivacySettings - checkbox without recommendation (on)", function() {
  stop();

  scanningController.getPrivacySettings(function(openSettings, totalSettings){
      equals(openSettings, 0,
             "The 'can friends post to wall?' should be ok on");
      equals(totalSettings, 21, "There should be 21 total settings");
      start();
    }, privacySettings4);
});
  });
  </script>

</head>
<body>

 <script type="text/javascript" src="testrunner.js"></script>
 <h1>QUnit test suite</h1>
 <h2 id="banner"></h2>
 <h2 id="userAgent"></h2>

 <ol id="tests"></ol>

 <div id="main"></div>

</body>
</html>
